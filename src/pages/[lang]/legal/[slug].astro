---
import MainLayout from '@/layouts/MainLayout.astro';
import { getEntry, render } from 'astro:content';
import { getLangFromUrl, useTranslations } from '@/i18n/utils';

export async function getStaticPaths() {
  const languages = ['en', 'es'];
  const slugs = ['privacy', 'terms', 'cookies'];
  return languages.flatMap((lang) => 
    slugs.map((slug) => ({ params: { lang, slug } }))
  );
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const { slug } = Astro.params;

const entry = await getEntry('legal', `${lang}/${slug}`);

if (!entry) {
  return Astro.redirect(`/${lang}/404`);
}

const { Content } = await render(entry);

const formattedDate = entry.data.date.toLocaleDateString(lang, {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<MainLayout>
  <section class="relative min-h-screen pt-32 pb-20 px-6 bg-mono-darker text-white">
    <div class="max-w-4xl mx-auto">
      
      <nav class="flex items-center gap-2 text-xs font-mono text-slate-500 mb-8 uppercase tracking-widest">
        <span class="text-emerald-500">{t('site.name')}</span>
        <span>/</span>
        <span>{t('legal.nav_label')}</span>
        <span>/</span>
        <span class="text-white">{slug}</span>
      </nav>

      <div class="animate-in slide-in-from-bottom-4 duration-700">
        <header class="mb-12 border-b border-white/5 pb-8">
           <h1 class="text-5xl font-bold text-white mb-4 tracking-tighter">
             {entry.data.title}
           </h1>
           <p class="text-xs font-mono text-emerald-500/60 uppercase tracking-widest">
             {t('legal.protocol_label')}
           </p>
        </header>

        <article class="prose prose-invert prose-emerald max-w-none 
          prose-headings:font-bold prose-a:text-emerald-400 
          prose-p:text-slate-300 prose-p:leading-relaxed">
          <Content />
        </article>

        <footer class="mt-16 pt-8 border-t border-white/5 text-slate-500 text-xs font-mono flex justify-between">
          <span>{t('legal.last_updated')}: {formattedDate}</span>
          <span class="opacity-50">{t('site.name')} v1.0</span>
        </footer>
      </div>
    </div>
  </section>
</MainLayout>