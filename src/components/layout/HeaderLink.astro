---
import type { HTMLAttributes } from 'astro/types';

type Props = HTMLAttributes<'a'>;

const { href, class: className, ...props } = Astro.props;

const base = import.meta.env.BASE_URL;
const hrefStr = String(href);

let finalHref: string;

if (hrefStr.startsWith('http') || hrefStr.startsWith('mailto:')) {
  finalHref = hrefStr;
} else {
  const pureHref = hrefStr.replace(new RegExp(`^${base}`), '/');
  
  finalHref = `${base}/${pureHref}`.replace(/\/+/g, '/');

  if (!finalHref.endsWith('/') && !finalHref.split('/').pop()?.includes('.')) {
    finalHref += '/';
  }
}

const pathname = Astro.url.pathname;
const isActive = pathname.replace(/\/+$/, '') === finalHref.replace(/\/+$/, '');
---

<a 
  href={finalHref} 
  class:list={[
    className,
    'cursor-target inline-block no-underline border-b-2 transition-all duration-300 py-1 text-sm font-medium hover:text-accent',
    { 'active-link border-accent font-bold': isActive },
    { 'text-mono-gray border-transparent': !isActive }
  ]} 
  {...props}
>
  <slot />
</a>

<style>
  .active-link { color: var(--text-main); }
  a:not(.active-link) { color: var(--color-mono-gray); }
</style>